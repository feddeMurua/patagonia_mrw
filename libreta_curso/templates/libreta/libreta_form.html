{% extends "base/base_form.html" %}
{% load staticfiles %}
{% load staticfiles bootstrap3 %}
{% load widget_tweaks %}

{% block title %}Libretas Sanitarias{% endblock %}

{% block header-title %}Alta/Modificacion de Libreta{% endblock %}

{% block url-volver %}{% url 'libretas:lista_libretas' %}{% endblock %}

{% block form-right %}
    {% if not modificacion %}
        <div class="col-xs-12 col-md-5" id="container-form-right">
            <div class=" panel panel-default">
                <div class="panel-heading movimiento-title">Datos de facturacion</div>
                <div class="panel-body">
                    <label>{{ mov_diario_form.nro_ingreso.label }}</label>
                    {{ mov_diario_form.nro_ingreso|add_class:'form-control' }}
                    {% for error in field.errors %}
                        <span class="help-block">{{ error }}</span>
                    {% endfor %}
                    {% for field in detalle_mov_diario_form %}
                        <div class="form-group">
                            <label>{{ field.label }}</label>
                            {{ field|add_class:'form-control' }}
                            {% for error in field.errors %}
                                <span class="help-block">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block btn-cancelar %}
    <a class="btn btn-danger btn-cancelar" href="{% url 'libretas:lista_libretas' %}">Cancelar</a>
{% endblock %}

{% block scripts %}
    <script>
        $.datepicker.setDefaults({
            maxDate: new Date()
        });

        var forma_pago = $('#id_forma_pago'),
        nro_cheque = $('#id_nro_cheque').parent(),
        persona = $('#id_persona'),
        selectCurso = document.getElementById('id_curso').selectize;
        forma_pago.on('change', hideNroCheque);
        hideNroCheque();

        function hideNroCheque() {
            if (forma_pago.val() == 'Cheque') {
                nro_cheque.removeClass('hidden');
            } else {
                nro_cheque.addClass('hidden');
            }
        }

        persona.on('change', setOptionsSelect);
        setOptionsSelect();
        function setOptionsSelect() {
            var id_persona = persona.val()
            if (id_persona) {
                $.ajax({
                    url: '/libretas/getCurso/' + id_persona,
                    dataType: 'json',
                    success: function(data){
                        selectCurso.clearOptions();
                        $.each(data, function(key, opt) {
                            selectCurso.addOption({value: opt, text: key});
                            selectCurso.addItem(opt);
                        })
                    },
                    error: function(err){
                        alert("Fallo Ajax");
                    }
                });
            }
        }
    </script>
{% endblock %}