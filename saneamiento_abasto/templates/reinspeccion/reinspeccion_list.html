{% extends "base/base_listado.html" %}
{% load staticfiles bootstrap3 %}

{% block title %}Reinspecciones{% endblock %}

{% block header-title %}Reinspecciones{% endblock %}

{% block panel-title %}Reinspecciones{% endblock %}

{% block btn-nuevo %}
    <a href="{% url 'reinspecciones:nueva_reinspeccion' %}" class="btn btn-primary btn-create">Nueva Reinspeccion</a>
    {% if user.is_staff %}
        <a href="{% url 'reinspecciones:nueva_reinspeccion_cc' %}" class="btn btn-success">Nueva Reinspeccion a Cuenta Corriente</a>
        <a href="{% url 'reinspecciones:precios_reinspeccion' %}" class="btn btn-info">Precios Vigentes</a>
    {% endif %}
    <a href="javascript:void(0);" onclick="fnClickAddRow();" class="btn btn-warning">Filtrar</a>
{% endblock %}

{% block tabla %}
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Turno</th>
            <th>Certificado</th>
            <th>Abastecedor</th>
            <th>Origen</th>
            <th>Total Kg</th>
            <th><em class="glyphicon glyphicon-cog"></em></th>
        </tr>
    </thead>
    <tbody>
        {% for reinspeccion in listado %}
            <tr>
                <td>{{ reinspeccion.fecha }}</td>
                <td>{{ reinspeccion.turno }}</td>
                <td>{{ reinspeccion.certificado }}</td>
                <td>{{ reinspeccion.abastecedor }}</td>
                <td>{{ reinspeccion.origen.nombre|default_if_none:"" }}</td>
                <td>{{ reinspeccion.total_kg }}</td>
                <td>
                    {% if not reinspeccion.detalles %}
                        <a class="btn btn-info" data-toggle="tooltip" title="Carga de Productos" href="{% url 'reinspecciones:carga_productos' reinspeccion.pk %}"><em class="glyphicon glyphicon-th-list"></em></a>
                    {% endif %}
                    <a class="btn btn-warning" data-toggle="tooltip" title="Lista de Productos" href="{% url 'reinspecciones:lista_productos' reinspeccion.pk 0 %}"><em class="glyphicon glyphicon-list-alt"></em></a>
                    {% if user.is_staff %}
                        <a class="btn btn-default" data-toggle="tooltip" title="Modificar" href="{% url 'reinspecciones:modificar_reinspeccion' reinspeccion.pk 0 %}"><em class="glyphicon glyphicon-pencil"></em></a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </tbody>

{% endblock %}

{% block more-scripts %}

  <script type="text/javascript">

    var table = $("#table-list tbody");

    function eventFired() {

      var value = $('.dataTables_filter input').val();

      $.ajax({
          url: "{% url 'reinspecciones:datatable_preloader' %}",
          method: "GET",
          xhrFields: {
              withCredentials: true
          },
          data: {
            "filtro": value
          },
          success: function (data) {

            $.each(data, function(key, value) {

              var obj = JSON.parse(value);

              $.each(obj, function(k, v) {
                $('#table-list').dataTable().fnAddData( [
              		v.fields.fecha,
              		v.fields.turno,
              		v.fields.certificado,
              		v.fields.abastecedor,
                  v.fields.origen,
                  v.fields.total_kg,
                  0] );
              });
            });
          }
      });
    }

    function fnClickAddRow() {
      eventFired();
      $('.dataTables_filter input').val('').keyup();
    }

  </script>

{% endblock %}
